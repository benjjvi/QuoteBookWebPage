{% extends "base.html" %}

{% block title %}Quote Book{% endblock %}

{% block extra_css %}
<link
  rel="stylesheet"
  href="/static/assets/css/index.css"
/>
{% endblock %}

{% block content %}
<section class="index-grid">
  <!-- Intro / Stats -->
  <div class="card card-intro">
    <h1>Quote Book</h1>
    <p class="muted">
      Enough for a trip to HR, but not enough to go to jail.
    </p>

    <div class="stats">
      <div class="stat">
        <span class="stat-number">{{ total_quotes }}</span>
        <span class="stat-label">total quotes</span>
      </div>

      <div class="stat">
        <span class="stat-label">Last checked</span>
        <span class="stat-meta">
          {{ now.strftime("%d %b %Y, %H:%M") }}
        </span>
      </div>
    </div>

    <div class="pwa-actions">
      <button type="button" class="btn btn-primary btn-install" id="installBtn">
        Install app
      </button>
    </div>
    <p class="install-status" id="installStatus" aria-live="polite"></p>
    <div class="install-help" id="installHelp" hidden></div>
  </div>

  <!-- Navigation -->
  <div class="card card-nav">
    <h2>Explore</h2>

    <div class="nav-grid" id="navGrid">
      <a
        href="/all_quotes"
        class="nav-item nav-item-wide"
        data-offline-allowed="true"
      >
        <img src="/static/assets/img/book.svg" alt="" />
        <span>All quotes</span>
      </a>

      <a
        href="/random"
        class="nav-item"
        data-offline-allowed="true"
      >
        <img src="/static/assets/img/dice.svg" alt="" />
        <span>Random</span>
      </a>

      <a href="/battle" class="nav-item" data-offline-allowed="false">
        <img src="/static/assets/img/battle.svg" alt="" />
        <span>Battle</span>
      </a>

      <a href="/search" class="nav-item" data-offline-allowed="false">
        <img src="/static/assets/img/search.svg" alt="" />
        <span>Search</span>
      </a>

      <a href="/add_quote" class="nav-item" data-offline-allowed="false">
        <img src="/static/assets/img/add.svg" alt="" />
        <span>Add quote</span>
      </a>

      <a href="/ai" class="nav-item" data-offline-allowed="false">
        <img src="/static/assets/img/robot.svg" alt="" />
        <span>AI</span>
      </a>

      <a
        href="/timeline/{{ now.year }}/{{ now.month }}"
        class="nav-item"
        data-offline-allowed="false"
      >
        <img src="/static/assets/img/calendar.svg" alt="" />
        <span>Calendar</span>
      </a>

      <a href="/stats" class="nav-item" data-offline-allowed="false">
        <img src="/static/assets/img/stats.svg" alt="" />
        <span>Stats</span>
      </a>
      {% if edit_enabled %}
        <a href="/edit" class="nav-item" data-offline-allowed="false">
          <img src="/static/assets/img/add.svg" alt="" />
          <span>Edit</span>
        </a>
      {% endif %}
    </div>
  </div>

  <!-- Speakers -->
  <div class="card card-speakers">
    <h2>Speakers</h2>

    <ul class="speaker-list">
      {% for speaker, count in speaker_counts[:5] %}
        <li>
          <span class="speaker-name">{{ speaker }}</span>
          <span class="speaker-count">{{ count }}</span>
        </li>
      {% endfor %}
    </ul>
  </div>
</section>

<div class="notify-modal" id="notifyModal" hidden aria-hidden="true">
  <div class="notify-card" role="dialog" aria-modal="true" aria-labelledby="notifyTitle">
    <span class="eyebrow">Notifications</span>
    <h2 id="notifyTitle">Get new quote alerts?</h2>
    <p class="lead">
      If you want, we can send a notification each time a new quote is added.
    </p>
    <div class="notify-actions">
      <button type="button" class="btn btn-primary" id="notifyAccept">
        Allow notifications
      </button>
      <button type="button" class="btn btn-ghost" id="notifyDecline">
        Not now
      </button>
    </div>
    <p class="notify-status" id="notifyStatus" aria-live="polite"></p>
  </div>
</div>

<div class="notify-modal" id="emailModal" hidden aria-hidden="true">
  <div class="notify-card" role="dialog" aria-modal="true" aria-labelledby="emailTitle">
    <span class="eyebrow">Email updates</span>
    <h2 id="emailTitle">Get the weekly quote digest?</h2>
    <p class="lead">
      Drop your email to get a Monday morning round-up of the latest quotes.
    </p>
    <form id="emailSubscribeForm" class="notify-form">
      <label for="emailSubscribeInput" class="notify-label">Email address: </label>
      <input
        id="emailSubscribeInput"
        class="notify-input"
        name="email"
        type="email"
        placeholder="you@example.com"
        autocomplete="email"
        required
      />
      <div class="notify-actions">
        <button type="submit" class="btn btn-primary" id="emailSubscribeAccept">
          Subscribe
        </button>
        <button type="button" class="btn btn-ghost" id="emailSubscribeDecline">
          Not now
        </button>
      </div>
    </form>
    <p class="notify-status" id="emailSubscribeStatus" aria-live="polite"></p>
  </div>
</div>


<script id="qbIndexConfig" type="application/json">
  {{
    {
      "vapidPublicKey": vapid_public_key,
      "pushSubscribeToken": push_subscribe_token,
      "emailSubscribeToken": email_subscribe_token,
    } | tojson
  }}
</script>
<script src="/static/assets/js/index.js"></script>

{% endblock %}
