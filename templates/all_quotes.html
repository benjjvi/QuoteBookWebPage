{% extends "base.html" %} {% block title %}All Quotes{% endblock %} {% block
extra_css %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='assets/css/all_quotes.css') }}"
/>
{% endblock %} {% block content %}
<div class="container">
  <div class="top-bar">
    <h1>All Quotes</h1>
    <a href="{{ url_for('index') }}" class="btn">Back home</a>
  </div>

  <form method="get">
    <input type="hidden" name="page" value="1">

    <label for="speaker">Filter by speaker:</label>
    <div class="speaker-select-wrapper">
      <select
        name="speaker"
        id="speaker"
        class="speaker-select"
        onchange="this.form.submit()"
      >

        <option value="">All Speakers</option>
        {% for spk, count in speakers %}
          <option
            value="{{ spk }}"
            {% if spk == selected_speaker %}selected{% endif %}
          >
            {{ spk }} ({{ count }})
          </option>
        {% endfor %}

      </select>
    </div>
    <noscript><button type="submit">Filter</button></noscript>
  </form>

  {% for q in quotes %}
    <div class="quote-card">
      <div class="quote-text">{{ q.quote }}</div>

      <div class="quote-author">
        —
        {{
          [
            q.authors | join(", "),
            q.timestamp | uk_date,
            q.timestamp | uk_time,
            q.context
          ]
          | select
          | join(", ")
        }}
      </div>

      <br />

      <a href="{{ url_for('quote_by_id', quote_id=q.id) }}" class="btn-quote">
        View
      </a>
    </div>
  {% else %}
  <p>No quotes found.</p>
  {% endfor %}

  {% if total_pages > 1 %}
  <div class="pagination">
    {% if page > 1 %}
      <a
        href="{{ url_for('all_quotes', speaker=selected_speaker, page=page-1) }}"
        class="btn"
      >
        ← Prev
      </a>
    {% endif %}

    <span class="page-indicator">
      <form method="get" class="page-jump">
        {% if selected_speaker %}
          <input type="hidden" name="speaker" value="{{ selected_speaker }}">
        {% endif %}

        <label>
          Page
          <input
            type="text"
            name="page"
            value="{{ page }}"
            inputmode="numeric"
            pattern="[0-9]*"
            class="page-input"
          />
          of {{ total_pages }}
        </label>
      </form>

    </span>

    {% if page < total_pages %}
      <a
        href="{{ url_for('all_quotes', speaker=selected_speaker, page=page+1) }}"
        class="btn"
      >
        Next →
      </a>
    {% endif %}
  </div>
{% endif %}


</div>

<script>
  document.addEventListener("focusin", (e) => {
    if (e.target.classList.contains("page-input")) {
      e.target.select();
    }
  });
</script>

{% endblock %}
