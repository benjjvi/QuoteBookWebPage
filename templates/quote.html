{% extends "base.html" %}

{% block title %}Quote #{{ id }}{% endblock %}

{% block extra_css %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='assets/css/quote.css') }}"
/>
{% endblock %}

{% block content %}
<section class="quote-page">
  <article class="quote-card">
    {% if not reroll_button %}
      <header class="quote-header">
        <span class="quote-id">Quote #{{ id }}</span>
      </header>
    {% endif %}

    <blockquote class="quote-text">
      “{{ quote }}”
    </blockquote>

    <div class="quote-author">
      — {{ author }}
    </div>

    {% if context %}
      <div class="quote-context">
        <strong>Context:</strong> {{ context }}
      </div>
    {% endif %}

    <div class="quote-meta">
      <span>{{ date }}</span>
      <span>•</span>
      <span>{{ time }}</span>
    </div>

    <div class="quote-actions">
      <a href="{{ url_for('index') }}" class="btn btn-secondary">
        Back home
      </a>

      {% if reroll_button %}
        <a href="{{ url_for('random') }}" class="btn btn-primary">
          Another quote
        </a>
      {% endif %}
      <button type="button" class="btn btn-primary" onclick="copyQuote()">
        Copy quote
      </button>

      <button type="button" class="btn btn-primary" onclick="permalinkQuote()">
        Permalink
      </button>
      {% if edit_enabled and edit_authed %}
        <a href="{{ url_for('edit_quote', quote_id=quote_id) }}" class="btn btn-secondary">
          Edit
        </a>
      {% endif %}
    </div>

    <script>
      function writeToClipboard(value, successMessage) {
        if (!navigator.clipboard) {
          window.prompt("Copy to clipboard:", value);
          return;
        }

        navigator.clipboard.writeText(value).then(() => {
          alert(successMessage);
        }).catch(() => {
          window.prompt("Copy to clipboard:", value);
        });
      }

      function copyQuote() {
        const text = `“{{ quote }}” — {{ author }}`;
        writeToClipboard(text, "Quote copied!");
      }

      function permalinkQuote() {
        const url = "{{ permalink }}";
        writeToClipboard(url, "Permalink copied!");
      }
    </script>
  </article>
</section>
{% endblock %}
